<!DOCTYPE html>
<html>
<head>
	<title>PhAsEr RpG?</title>
	<meta charset="utf-8">
	<script src="phaser.min-2.7.7.js"></script>
	<script src="gameskills.js"></script>
</head>
<body>
	<script name="ver">//-----------------------------------------------------
		var ver = '0.4';
		var udt = "0601: bullet! Next time it'd be the formal ver"
	</script>

	<script name="init">//SAVE //man=p1,left   foe=p2,right
		var manlv = 1;
		var manexp = 0;
		var foelv = 1;
		var foeexp = 0;

		var hpfontformat = {font: 'Hall Fetica', fontSize: '25px'} ;
		var mpfontformat = {font: 'Hall Fetica', fontSize: '16px', fill: 'blue'};
	

		var sklfontformat = {font: 'Hall Fetica', fontSize: '16px', fill: 'purple'};
		var mansskill = 0;
		var foesskill = 0;

		//style 1=balance 2=sniper 3=machinegun
		var manstyle = 1;
		var foestyle = 1;
		var manatk = 5;
		var foeatk = 5;
		var manmaxhp = 500;
		var manhp = manmaxhp;
		var foemaxhp = 500;
		var foehp = foemaxhp;
		var manshootspd = 400;
		var foeshootspd = 400;
		var mandef = 0;
		var foedef = 0;
		var manmaxmp = 500;
		var manmp = manmaxmp;
		var foemaxmp = 500;
		var foemp = foemaxmp;

	</script>

	<script name="game">
		var width = 650;
		var height = 450;
		var gamestarted = false;
		var game = new Phaser.Game(width, height, Phaser.CANVAS, 'game');
		game.States = {};

		game.States.boot = function(){
			this.preload = function(){};
			this.create = function(){
				game.state.start('preload')
			};
		}

		game.States.preload = function(){
			this.preload = function(){
    			game.load.spritesheet('man','asset/bird1.png',34,24,6); 
    			game.load.spritesheet('foe','asset/bird2b.png',34,24,6);
    			game.load.spritesheet('play-icon','asset/play-icon.png');
    			game.load.image('bullet','asset/bullet');
    			game.load.image('bullet2','asset/bullet2');
    			var progressText = game.add.text(game.world.centerX, game.world.centerY, '0%', {
   					fontSize: '60px',
    				fill: '#ffffff',
    				font: 'Hall Fetica'
				});
				progressText.anchor.setTo(0.5, 0.5); 
				// 监听加载完一个文件的事件
				game.load.onFileComplete.add(function(progress) {
    				progressText.text = progress + '%';
				});
		     };
		     this.create = function(){
		     	game.state.start('menu');
		     }
		}


	
		game.States.menu = function(){
			this.create = function(){
				game.stage.backgroundColor = '#ffe4e1';
				var btn = game.add.button(300,170,'play-icon',function(){
					game.state.start('play');
				});
				btn.anchor.setTo(0.5,0);

				game.add.text(0, 0, 'V.' + ver ,{fontSize:'16px', font:'Hall Fetica'});
				game.add.text(0,16, udt, {fontSize:'14px', font:'Hall Fetica'});
			}

			this.update = function(){
				enter = game.input.keyboard.addKey(Phaser.Keyboard.ENTER);
				if(enter.isDown){game.state.start('play'); }
			}
		};



		game.States.play = function(){
			this.create = function(){
				gamestarted = true;
				//printhp
				this.printmanhp = game.add.text(22, 20, manhp, hpfontformat);
				this.printmanof = game.add.text(70, 20, '/', hpfontformat);
				this.printmanmaxhp = game.add.text(90, 20, manmaxhp, hpfontformat);
				this.printfoehp = game.add.text(522, 20, foehp, hpfontformat);
				this.printfoeof = game.add.text(570, 20, '/', hpfontformat);
				this.printfoemaxhp = game.add.text(590, 20, foemaxhp, hpfontformat);

				//printmp
				this.printmanmp = game.add.text(22, 50, manmp, mpfontformat);
				this.printmanofm = game.add.text(55, 50, '/', mpfontformat);
				this.printmanmaxmp = game.add.text(70, 50, manmaxmp, mpfontformat);
				this.printfoemp = game.add.text(542, 50, foemp, mpfontformat);
				this.printfoeofm = game.add.text(575, 50, '/', mpfontformat);
				this.printfoemaxmp = game.add.text(590, 50, foemaxmp, mpfontformat);

				/*//print skill
				this.printmanskl = game.add.text(22, 70, skills[mansskill], sklfontformat);
				*/

				//graph & gravity
				this.man = game.add.sprite(50, 150, 'man');
				this.man.animations.add('goright', [0, 1, 2], 10, true);
				this.man.animations.add('goleft',[3, 4, 5], 10, true);
    		    this.man.animations.play('goright');
				game.physics.arcade.enable(this.man, Phaser.Physics.P2);
				this.man.body.collideWorldBounds = true;
				this.man.body.gravity.y = 490;

				this.foe = game.add.sprite(550, 150, 'foe');
    			this.foe.animations.add('fgoright', [0, 1, 2], 10, true);
				this.foe.animations.add('fgoleft',[3, 4, 5], 10, true);
    		    this.foe.animations.play('fgoleft');
				game.physics.arcade.enable(this.foe, Phaser.Physics.P2);
				this.foe.body.collideWorldBounds = true;
				this.foe.body.gravity.y = 490;

				//input
				cursors = game.input.keyboard.createCursorKeys();
				enter = game.input.keyboard.addKey(Phaser.Keyboard.ENTER); 
  			    spacebar = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
  			    manjump = game.input.keyboard.addKey(82);//R up
  			    mandown = game.input.keyboard.addKey(70);//F down!
  			    manleft = game.input.keyboard.addKey(68);//D left
  			    manright = game.input.keyboard.addKey(71);//F right
  			    manatk = game.input.keyboard.addKey(90);//Z attack!
  			    this.man.inputEnabled = true;

  				//this.man.input.enableDrag(true);

  				//skills

  				 //  Creates 30 bullets, using the 'bullet' graphic
  			     this.weaponm = game.add.weapon(30, 'bullet');
  			     //weapon's angle
  			     this.weaponm.fireAngle = 0;
  			     //  The bullet will be automatically killed when it leaves the world bounds
  			     this.weaponm.bulletKillType = Phaser.Weapon.KILL_WORLD_BOUNDS;
  			     //  Because our bullet is drawn facing up, we need to offset its rotation:
  			     this.weaponm.bulletAngleOffset = 0;
  			     //  The speed at which the bullet is fired
  			     this.weaponm.bulletSpeed = 400;
  			     //  Speed-up the rate of fire, allowing them to shoot 1 bullet every 60ms
  			     this.weaponm.fireRate = 200;
  			     //  Add a variance to the bullet angle by +- this value
  			     this.weaponm.bulletAngleVariance = 3;
  			     //  Tell the Weapon to track the 'player' Sprite, offset by 14px horizontally, 0 vertically
  			     this.weaponm.trackSprite(this.man, 14, 0);
  			     game.physics.arcade.enable(this.weaponm, Phaser.Physics.P2);
  				
  			     this.weaponf = game.add.weapon(30, 'bullet2');
  			     this.weaponf.fireAngle = 180;
  			     this.weaponf.bulletKillType = Phaser.Weapon.KILL_WORLD_BOUNDS;
  			     this.weaponf.bulletAngleOffset = 0;
  			     this.weaponf.bulletSpeed = 400;
  			     this.weaponf.fireRate = 200;
  			     this.weaponf.bulletAngleVariance = 3;
  			     this.weaponf.trackSprite(this.foe, 14, 0);
  			     game.physics.arcade.enable(this.weaponf, Phaser.Physics.P2);
			}

			this.update = function(){
				this.man.body.velocity.x = 0;
				this.foe.body.velocity.x = 0;
				game.physics.arcade.collide(this.man, this.foe, this.mfcrash);
				game.physics.arcade.collide(this.weaponm, this.foe, this.foehitweaponm);

				//onfloor
				if(this.man.body.onFloor()==true){manhp-=0.5}
				if(this.foe.body.onFloor()==true){foehp-=0.5}

				//gg and print
				if(manhp > 0){this.printmanhp.text = Math.floor(manhp);}
					else{this.foewin();}
				if(foehp > 0){this.printfoehp.text = Math.floor(foehp);}
					else{this.manwin();}
				this.printmanmp.text = Math.floor(manmp);
				this.printfoemp.text = Math.floor(foemp);

				//move p1 man
				if (manleft.isDown){this.man.body.velocity.x = -250; this.man.animations.play('goleft'); }
   					else if(manright.isDown){this.man.body.velocity.x = 250; this.man.animations.play('goright');}
   			    if (manjump.isDown) {this.man.body.velocity.y = -300;}	
   			    	else if(mandown.isDown){this.man.body.velocity.y = 700;}

				//move p2(foe)
				if (cursors.left.isDown){this.foe.body.velocity.x = -250; this.foe.animations.play('fgoleft');}
   					else if(cursors.right.isDown){this.foe.body.velocity.x = 250; this.foe.animations.play('fgoright');}
   			    if (cursors.up.isDown) {this.foe.body.velocity.y = -300; }
   			    	else if(cursors.down.isDown){this.foe.body.velocity.y = 700;}

   			    //attack!!
   			    if(manatk.isDown && manmp>0){this.weaponm.fire(); manmp-=0.5;}
   			    if(enter.isDown && foemp>0){this.weaponf.fire(); foemp-=0.5;}

   			    //special attack!!

			}

			this.mfcrash = function(){
				manhp-=6;
				foehp-=6;
			}

			this.foehitweaponm = function(){
				foehp-=20;
				alert(',');
				this.weaponm.destroy();
			}

			this.foewin = function(){
				manhp = 0;
				this.printmanhp.text = 0;
			}

			this.manwin = function(){
				foehp = 0;
				this.printfoehp.text = 0;
			}
		}

		game.state.add('boot',game.States.boot);
		game.state.add('preload',game.States.preload);
		game.state.add('menu',game.States.menu);
		game.state.add('play',game.States.play);
		game.state.start('boot');
	</script>


<!-- =============================================================================================================================================== -->

	<h2>Hand-made phaserG???</h2>

	<script name="data">
		function cout(){
			if(gamestarted == true){
				document.getElementById("save").innerHTML = 
				manlv + '&j&c&' + 
				manexp + '&j&c&' + 
				foelv + '&j&c&' + 
				foeexp + '&j&c&' + 
				manmaxhp + '&j&c&' + 
				manhp + '&j&c&' + 
				foemaxhp + '&j&c&' +
				foehp + '&j&c&' +
			    manmaxmp + '&j&c&' + 
				foemaxmp ;
			}
			else{
				console.log('cout before play')
				alert('No savedata saved' + '\n' + "(Maybe you haven't gone into the REAL game)");
			}
		}

		function filecout(){
			var fs = require('fs');
			var data = fs.readFileSync(process.argv[2]);
			console.log(data.toString());
			fs.writeFileSync(process.argv[3], data);
		}

		function cin(){
			console.log('cin');
			alert('上傳存檔功能暫時不能使用，敬請期待!')
		}

		function filecin(){
			var fs = require('fs'); // 引用檔案物件
			var data = fs.readFileSync(process.argv[2], "utf8"); // 讀取檔案
			console.log(data); 
		}

		function fullscreen(){
			game.scale.fullScreenScaleMode = Phaser.ScaleManager.EXACT_FIT;
			game.scale.startFullScreen();
		}

	</script>



	<button type="button" onclick="cout()" style="position: absolute;top: 530px;">EXPORT SAVEDATA</button>
	<button type="button" onclick="fullscreen()" style="position: absolute; top: 530px; left: 250px">GO FULLSCREEN!</button>
	<button type="button" onclick="cin()" style="position: absolute;top: 530px;left: 500px">IMPORT SAVEDATA</button>
	<textarea id="save" style="position: absolute; top:560px; width: 650px;"></textarea>
</body>
</html>


<!--UPDATE LIST
皺褶世界
生(summon)小鳥(?)
彈幕攻擊
夥伴模式
耗MP攻擊/集氣
頭方向
碰撞
增益泡泡
子彈
防護罩
必殺技MP
增減益效果
合作打BOSS (?)
-->